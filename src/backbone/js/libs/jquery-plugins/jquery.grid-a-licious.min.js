/**
 * jQuery Grid-A-Licious(tm) v3.01
 *
 * Terms of Use - jQuery Grid-A-Licious(tm)
 * under the MIT (http://www.opensource.org/licenses/mit-license.php) License.
 *
 * Copyright 2008-2012 Andreas Pihlstr√∂m (Suprb). All rights reserved.
 * (http://suprb.com/apps/gridalicious/)
 *
 */

// Debouncing function from John Hann
// http://unscriptable.com/index.php/2009/03/20/debouncing-javascript-methods/
// Copy pasted from http://paulirish.com/2009/throttled-smartresize-jquery-event-handler/

// ** @nicopinto patch -- added custom resize callback **
// ** @brunolazzaro patch -- append to smallest column instead of sequentially **
!function(a,b){var c=function(a,b,c){var d;return function(){function g(){c||a.apply(e,f),d=null}var e=this,f=arguments;d?clearTimeout(d):c&&a.apply(e,f),d=setTimeout(g,b||150)}};jQuery.fn[b]=function(a){return a?this.bind("resize",c(a)):this.trigger(b)}}(jQuery,"smartresize"),function(a){function b(a){window.console&&window.console.log(a)}a.Gal=function(b,c){this.element=a(c),this._init(b)},a.Gal.settings={selector:".item",width:225,gutter:20,resizeCallback:function(){b("no override scrollcallback")},animate:!1,animationOptions:{speed:200,duration:300,effect:"fadeInOnAppear",queue:!0,complete:function(){}}},a.Gal.prototype={_init:function(b){var c=this;this.name=this._setName(5),this.gridArr=[],this.gridArrAppend=[],this.gridArrPrepend=[],this.setArr=!1,this.setGrid=!1,this.setOptions,this.cols=0,this.itemCount=0,this.prependCount=0,this.isPrepending=!1,this.appendCount=0,this.resetCount=!0,this.ifCallback=!0,this.box=this.element,this.options=a.extend(!0,{},a.Gal.settings,b),this.gridArr=a.makeArray(this.box.find(this.options.selector)),this.isResizing=!1,this.w=0,this.boxArr=[],this._setCols(),this._renderGrid("append"),a(this.box).addClass("gridalicious"),a(window).smartresize(function(){c.resize(),c.options.resizeCallback()})},_setName:function(a,b){return b=b?b:"",a?this._setName(--a,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+b):b},_setCols:function(){this.cols=Math.floor(this.box.width()/this.options.width),this.cols<1&&(this.cols=1),diff=(this.box.width()-this.cols*this.options.width-this.options.gutter)/this.cols,w=100*((this.options.width+diff)/this.box.width()),this.w=w;for(var b=0;b<this.cols;b++){var c=a("<div></div>").addClass("galcolumn").attr("id","item"+b+this.name).css({width:w+"%",paddingLeft:this.options.gutter,paddingBottom:this.options.gutter,"float":"left","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-o-box-sizing":"border-box","box-sizing":"border-box"});this.box.append(c)}this.box.find(a("#clear"+this.name)).remove();var d=a("<div></div>").css({clear:"both",height:"0",width:"0",display:"block"}).attr("id","clear"+this.name);this.box.append(d)},_renderGrid:function(b,c,d){var f=[],g=[],i=0;this.prependCount;var k=this.appendCount,l=this.options.gutter,m=this.cols;this.name,a(".galcolumn").width(),c?(g=c,"append"==b&&(k+=d,i=this.appendCount),"prepend"==b&&(this.isPrepending=!0,i=Math.round(d%m),0>=i&&(i=m)),"renderAfterPrepend"==b&&(k+=d,i=d)):(g=this.gridArr,k=a(this.gridArr).size()),a.each(g,function(c,d){var j,e=a(d),g="100%",h=1/0;e.hasClass("not-responsive")&&(g="auto"),e.css({marginBottom:l,zoom:"1",filter:"alpha(opacity=0)",opacity:"0"}).find("img, object, embed, iframe").css({width:g,height:"auto",display:"block","margin-left":"auto","margin-right":"auto"}),"prepend"==b?(i--,a(".galcolumn").each(function(b,c){a(c).height()<h&&(j=a(c),h=a(c).height())}),j.prepend(e),f.push(e),0==i&&(i=m)):(a(".galcolumn").each(function(b,c){a(c).height()<h&&(j=a(c),h=a(c).height())}),j.append(e),f.push(e),i++,i>=m&&(i=0),k>=m&&(k-=m))}),this.appendCount=k,this.itemCount=i,"append"==b||"prepend"==b?("prepend"==b&&this._updateAfterPrepend(this.gridArr,g),this._renderItem(f),this.isPrepending=!1):this._renderItem(this.gridArr)},_collectItems:function(){var b=[];return a(this.box).find(this.options.selector).each(function(){b.push(a(this))}),b},_renderItem:function(b){var c=this.options.animationOptions.speed,d=this.options.animationOptions.effect,e=this.options.animationOptions.duration,f=this.options.animationOptions.queue,g=this.options.animate,h=this.options.animationOptions.complete,i=0,j=0;g!==!0||this.isResizing?(a.each(b,function(b,c){a(c).css({opacity:"1",filter:"alpha(opacity=1)"})}),this.ifCallback&&h.call(b)):(f===!0&&"fadeInOnAppear"==d?(this.isPrepending&&b.reverse(),a.each(b,function(d,f){setTimeout(function(){a(f).animate({opacity:"1.0"},e),j++,j==b.length&&h.call(void 0,b)},i*c),i++})):f===!1&&"fadeInOnAppear"==d&&(this.isPrepending&&b.reverse(),a.each(b,function(c,d){a(d).animate({opacity:"1.0"},e),j++,j==b.length&&this.ifCallback&&h.call(void 0,b)})),f!==!0||d||a.each(b,function(c,d){a(d).css({opacity:"1",filter:"alpha(opacity=1)"}),j++,j==b.length&&this.ifCallback&&h.call(void 0,b)}))},_updateAfterPrepend:function(b,c){var d=this.gridArr;a.each(c,function(a,b){d.unshift(b)}),this.gridArr=d},resize:function(){this.box.find(a(".galcolumn")).remove(),this._setCols(),this.ifCallback=!1,this.isResizing=!0,this._renderGrid("append"),this.ifCallback=!0,this.isResizing=!1},append:function(b){var c=this.gridArr,d=this.gridArrPrepend;a.each(b,function(a,b){c.push(b),d.push(b)}),this._renderGrid("append",b,a(b).size())},prepend:function(b){this.ifCallback=!1,this._renderGrid("prepend",b,a(b).size()),this.ifCallback=!0}},a.fn.gridalicious=function(b,c){return"string"==typeof b?this.each(function(){var d=a.data(this,"gridalicious");d[b].apply(d,[c])}):this.each(function(){a.data(this,"gridalicious",new a.Gal(b,this))}),this}}(jQuery);
